parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"ZgtV":[function(require,module,exports) {
(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};jQuery(document).ready(function(e){"use strict";return window.SV_WC_Apple_Pay_Handler_v5_10_0=function(){function n(e){this.get_payment_request=t(this.get_payment_request,this),this.reset_payment_request=t(this.reset_payment_request,this),this.on_cancel_payment=t(this.on_cancel_payment,this),this.process_authorization=t(this.process_authorization,this),this.on_payment_authorized=t(this.on_payment_authorized,this),this.on_shipping_method_selected=t(this.on_shipping_method_selected,this),this.on_shipping_contact_selected=t(this.on_shipping_contact_selected,this),this.on_payment_method_selected=t(this.on_payment_method_selected,this),this.validate_merchant=t(this.validate_merchant,this),this.on_validate_merchant=t(this.on_validate_merchant,this),this.init_checkout_page=t(this.init_checkout_page,this),this.init_cart_page=t(this.init_cart_page,this),this.init_product_page=t(this.init_product_page,this),this.gateway_id=e.gateway_id,this.gateway_slug=e.gateway_slug,this.merchant_id=e.merchant_id,this.ajax_url=e.ajax_url,this.validate_nonce=e.validate_nonce,this.recalculate_totals_nonce=e.recalculate_totals_nonce,this.process_nonce=e.process_nonce,this.payment_request=e.payment_request,this.generic_error=e.generic_error,this.buttons=".sv-wc-apple-pay-button",this.terms=".sv-wc-apple-pay-terms"}return n.prototype.is_available=function(){return!!window.ApplePaySession&&ApplePaySession.canMakePaymentsWithActiveCard(this.merchant_id).then(function(t){return t})},n.prototype.init=function(){var t;if(this.is_available()&&(e("form.cart").length?this.init_product_page():e("form.woocommerce-cart-form").length?this.init_cart_page():e("form.woocommerce-checkout").length&&this.init_checkout_page(),this.ui_element))return this.payment_request&&(e(this.buttons).show(),e(this.terms).show()),e(document.body).on("click",".sv-wc-apple-pay-button",(t=this,function(e){var n;e.preventDefault(),t.block_ui();try{return t.session=t.get_new_session(t.payment_request),t.session.onvalidatemerchant=function(e){return t.on_validate_merchant(e)},t.session.onpaymentmethodselected=function(e){return t.on_payment_method_selected(e)},t.session.onshippingcontactselected=function(e){return t.on_shipping_contact_selected(e)},t.session.onshippingmethodselected=function(e){return t.on_shipping_method_selected(e)},t.session.onpaymentauthorized=function(e){return t.on_payment_authorized(e)},t.session.oncancel=function(e){return t.on_cancel_payment(e)},t.session.begin()}catch(o){return n=o,t.fail_payment(n)}}))},n.prototype.init_product_page=function(){return this.ui_element=e("form.cart")},n.prototype.init_cart_page=function(){return this.ui_element=e("form.woocommerce-cart-form").parents("div.woocommerce"),e(document.body).on("updated_cart_totals",(t=this,function(){return t.reset_payment_request()}));var t},n.prototype.init_checkout_page=function(){return this.ui_element=e("form.woocommerce-checkout"),this.buttons=".sv-wc-apply-pay-checkout",e(document.body).on("updated_checkout",(t=this,function(){return t.reset_payment_request()}));var t},n.prototype.get_new_session=function(t){return new ApplePaySession(this.get_sdk_version(),t)},n.prototype.get_sdk_version=function(){return 2},n.prototype.on_validate_merchant=function(t){return this.validate_merchant(t.validationURL).then((n=this,function(t){return t=e.parseJSON(t),n.session.completeMerchantValidation(t)}),function(t){return function(e){return t.session.abort(),t.fail_payment("Merchant could no be validated. "+e.message)}}(this));var n},n.prototype.validate_merchant=function(t){return new Promise((n=this,function(o,i){var s;return s={action:"wc_"+n.gateway_id+"_apple_pay_validate_merchant",nonce:n.validate_nonce,merchant_id:n.merchant_id,url:t},e.post(n.ajax_url,s,function(t){return t.success?o(t.data):i(t.data)})}));var n},n.prototype.on_payment_method_selected=function(t){return new Promise((n=this,function(t,o){var i;return i={action:"wc_"+n.gateway_id+"_apple_pay_recalculate_totals",nonce:n.recalculate_totals_nonce},e.post(n.ajax_url,i,function(e){return e.success?(i=e.data,t(n.session.completePaymentMethodSelection(i.total,i.line_items))):(console.error("[Apple Pay] Error selecting a shipping contact. "+e.data.message),o(n.session.completePaymentMethodSelection(n.payment_request.total,n.payment_request.lineItems)))})}));var n},n.prototype.on_shipping_contact_selected=function(t){return new Promise((n=this,function(o,i){var s;return s={action:"wc_"+n.gateway_id+"_apple_pay_recalculate_totals",nonce:n.recalculate_totals_nonce,contact:t.shippingContact},e.post(n.ajax_url,s,function(t){return t.success?(s=t.data,o(n.session.completeShippingContactSelection(ApplePaySession.STATUS_SUCCESS,s.shipping_methods,s.total,s.line_items))):(console.error("[Apple Pay] Error selecting a shipping contact. "+t.data.message),i(n.session.completeShippingContactSelection(ApplePaySession.STATUS_FAILURE,[],n.payment_request.total,n.payment_request.lineItems)))})}));var n},n.prototype.on_shipping_method_selected=function(t){return new Promise((n=this,function(o,i){var s;return s={action:"wc_"+n.gateway_id+"_apple_pay_recalculate_totals",nonce:n.recalculate_totals_nonce,method:t.shippingMethod.identifier},e.post(n.ajax_url,s,function(t){return t.success?(s=t.data,o(n.session.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS,s.total,s.line_items))):(console.error("[Apple Pay] Error selecting a shipping method. "+t.data.message),i(n.session.completeShippingMethodSelection(ApplePaySession.STATUS_FAILURE,n.payment_request.total,n.payment_request.lineItems)))})}));var n},n.prototype.on_payment_authorized=function(t){return this.process_authorization(t.payment).then((e=this,function(t){return e.set_payment_status(!0),e.complete_purchase(t)}),function(t){return function(e){return t.set_payment_status(!1),t.fail_payment("Payment could no be processed. "+e.message)}}(this));var e},n.prototype.process_authorization=function(t){return new Promise((n=this,function(o,i){var s;return s={action:"wc_"+n.gateway_id+"_apple_pay_process_payment",nonce:n.process_nonce,payment:JSON.stringify(t)},e.post(n.ajax_url,s,function(t){return t.success?o(t.data):i(t.data)})}));var n},n.prototype.on_cancel_payment=function(t){return this.unblock_ui()},n.prototype.complete_purchase=function(t){return window.location=t.redirect},n.prototype.fail_payment=function(t){return console.error("[Apple Pay] "+t),this.unblock_ui(),this.render_errors([this.generic_error])},n.prototype.set_payment_status=function(t){var e;return e=t?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE,this.session.completePayment(e)},n.prototype.reset_payment_request=function(t){return null==t&&(t={}),this.block_ui(),this.get_payment_request(t).then((n=this,function(t){return e(n.buttons).show(),e(n.terms).show(),n.payment_request=e.parseJSON(t),n.unblock_ui()}),function(t){return function(n){return console.error("[Apple Pay] Could not build payment request. "+n.message),e(t.buttons).hide(),e(t.terms).hide(),t.unblock_ui()}}(this));var n},n.prototype.get_payment_request=function(t){return new Promise((n=this,function(o,i){var s;return s={action:"wc_"+n.gateway_id+"_apple_pay_get_payment_request"},e.extend(t,s),e.post(n.ajax_url,t,function(t){return t.success?o(t.data):i(t.data)})}));var n},n.prototype.render_errors=function(t){return e(".woocommerce-error, .woocommerce-message").remove(),this.ui_element.prepend('<ul class="woocommerce-error"><li>'+t.join("</li><li>")+"</li></ul>"),this.ui_element.removeClass("processing").unblock(),e("html, body").animate({scrollTop:this.ui_element.offset().top-100},1e3)},n.prototype.block_ui=function(){return this.ui_element.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},n.prototype.unblock_ui=function(){return this.ui_element.unblock()},n}(),e(document.body).trigger("sv_wc_apple_pay_handler_v5_10_0_loaded")})}).call(this);
},{}]},{},["ZgtV"], null)
//# sourceMappingURL=/sv-wc-payment-gateway-apple-pay.min.js.map